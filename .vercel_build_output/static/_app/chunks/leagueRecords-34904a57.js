import{g as x,a as E,b as O}from"./leagueUsers-b0fdd0b7.js";import{l as C}from"./index.svelte_svelte&type=style&lang-b0d2c838.js";import{g as K}from"./nflState-b19b4ad8.js";import{w as I,b}from"./news-c1036290.js";import{ae as J}from"./vendor-60eb0dec.js";const V=async(N=!1)=>{if(J(b).seasonWeekRecords)return J(b);if(!N){let t=await JSON.parse(localStorage.getItem("records"));if(t)return t.stale=!0,t}const y=await K().catch(t=>{console.error(t)});let i=0;y.season_type=="regular"?i=y.week-1:y.season_type=="post"&&(i=18);let c=C,k,D,v,u=[],r={},S=[],d=[],w=[],P=[],j=[];for(;c&&c!=0;){const[t,p,m]=await I(O(c),E(c),x(c)).catch(s=>{console.error(s)});let f=parseInt(m.season);(m.status=="complete"||i>m.settings.playoff_week_start-1)&&(i=m.settings.playoff_week_start-1),v=f;const T=t.rosters,g={};for(const s of T){const e=s.roster_id,a=p[s.owner_id];if(a?g[e]={avatar:`https://sleepercdn.com/avatars/thumbs/${a.avatar}`,name:a.metadata.team_name?a.metadata.team_name:a.display_name}:g[e]={avatar:"https://sleepercdn.com/images/v2/icons/player_default.webp",name:"Unknown Manager"},s.settings.wins==0&&s.settings.ties==0&&s.settings.losses==0)continue;r[e]||(r[e]={wins:0,losses:0,ties:0,fptsFor:0,fptsAgainst:0,potentialPoints:0,years:[]});const o=s.settings.fpts+s.settings.fpts_decimal/100,n=s.settings.fpts_against+s.settings.fpts_against_decimal/100,l=s.settings.ppts+s.settings.ppts_decimal/100;r[e].wins+=s.settings.wins,r[e].losses+=s.settings.losses,r[e].ties+=s.settings.ties,r[e].fptsFor+=o,r[e].fptsAgainst+=n,r[e].potentialPoints+=l;const _={wins:s.settings.wins,losses:s.settings.losses,ties:s.settings.ties,fpts:o,fptsAgainst:n,potentialPoints:l,manager:g[e],year:f};r[e].years.push(_),w.push({rosterID:e,fpts:o,year:f,manager:g[e]})}k||(k=g);const M=[];let L=parseInt(i);for(;i>0;)M.push(fetch(`https://api.sleeper.app/v1/league/${c}/matchups/${i}`,{compress:!0})),i--;const U=await I(...M).catch(s=>{console.error(s)}),W=[];for(const s of U){const e=s.json();if(W.push(e),!s.ok)throw new Error(e)}const Y=await I(...W).catch(s=>{console.error(s)});c=m.previous_league_id;const A=[];let h=[];for(const s of Y){let e={};for(const a of s){const o={manager:g[a.roster_id],fpts:a.points,week:L,year:f,rosterID:a.roster_id};A.push(o),d.push(o),e[a.matchup_id]||(e[a.matchup_id]=[]),e[a.matchup_id].push(o)}L--;for(const a in e){const o=e[a];let n=o[0],l=o[1];o[0].fpts<o[1].fpts&&(n=o[1],l=o[0]);const _={year:n.year,week:n.week,home:{manager:n.manager,fpts:n.fpts,rosterID:n.rosterID},away:{manager:l.manager,fpts:l.fpts,rosterID:l.rosterID},differential:n.fpts-l.fpts};u.push(_),h.push(_)}}h=h.sort((s,e)=>e.differential-s.differential);const $=h.slice(0,10),B=[];for(let s=0;s<10;s++)B.push(h.pop());const F={year:f,biggestBlowouts:$,closestMatchups:B,seasonPointsRecords:A.sort((s,e)=>e.fpts-s.fpts).slice(0,10)};F.seasonPointsRecords.length>0&&(D||(D=f),S.push(F))}u=u.sort((t,p)=>p.differential-t.differential),P=u.slice(0,10);for(let t=0;t<10;t++)j.push(u.pop());d=d.sort((t,p)=>p.fpts-t.fpts).slice(0,10),w=w.sort((t,p)=>p.fpts-t.fpts).slice(0,10);const R={allTimeBiggestBlowouts:P,allTimeClosestMatchups:j,mostSeasonLongPoints:w,leagueWeekRecords:d,seasonWeekRecords:S,leagueRosterRecords:r,currentManagers:k,currentYear:D,lastYear:v};return localStorage.setItem("records",JSON.stringify(R)),b.update(()=>R),R};export{V as g};
