import{g as L,a as y,b}from"./leagueUsers-b0fdd0b7.js";import{w as v,a as h}from"./news-c1036290.js";import{ae as R}from"./vendor-60eb0dec.js";const q=async()=>{if(R(h).podiums)return R(h);const[a,d,c]=await v(b(),y(),L()).catch(s=>{console.error(s)}),l=a.rosters,n={};for(const s of l){const t=d[s.owner_id];t?n[s.roster_id]={avatar:`https://sleepercdn.com/avatars/thumbs/${t.avatar}`,name:t.metadata.team_name?t.metadata.team_name:t.display_name}:n[s.roster_id]={avatar:"https://sleepercdn.com/images/v2/icons/player_default.webp",name:"Unknown Manager"}}let o=c.previous_league_id;const r={podiums:await U(o),currentManagers:n};return h.update(()=>r),r},U=async a=>{const d=[];for(;a&&a!=0;){const c=await P(a),{losersData:l,winnersData:n,year:o,previousRosters:e,numDivisions:r,usersData:s,playoffRounds:t,toiletRounds:u,leagueMetadata:_}=c;a=c.previousSeasonID;const{divisions:m,prevManagers:p}=x({usersData:s,previousRosters:e,leagueMetadata:_,numDivisions:r}),w=[];for(const i in m)m[i].manager=p[m[i].roster],w.push(m[i]);const f=n.filter(i=>i.r==t&&i.t1_from.w)[0],g=p[f.w],M=p[f.l],D=n.filter(i=>i.r==t&&i.t1_from.l)[0],k=p[D.w],j=l.filter(i=>i.r==u&&(!i.t1_from||i.t1_from.w))[0],$=p[j.w],A={year:o,champion:g,second:M,third:k,divisions:w,toilet:$};d.push(A)}return d},P=async a=>{const d=[fetch(`https://api.sleeper.app/v1/league/${a}`,{compress:!0}),b(a),y(a),fetch(`https://api.sleeper.app/v1/league/${a}/losers_bracket`,{compress:!0}),fetch(`https://api.sleeper.app/v1/league/${a}/winners_bracket`,{compress:!0})],[c,l,n,o,e]=await v(...d).catch(g=>{console.error(g)});if(!c.ok||!o.ok||!e.ok)throw new Error(data);const r=[c.json(),o.json(),e.json()],[s,t,u]=await v(...r).catch(g=>{console.error(g)}),_=s.season,m=l.rosters,p=s.settings.divisions||1;a=s.previous_league_id;const w=u[u.length-1].r,f=t[t.length-1].r;return{losersData:t,winnersData:u,year:_,previousRosters:m,numDivisions:p,usersData:n,previousSeasonID:a,playoffRounds:w,toiletRounds:f,leagueMetadata:s.metadata}},x=({usersData:a,previousRosters:d,leagueMetadata:c,numDivisions:l})=>{const n={},o={};for(let e=0;e<l;e++)o[e+1]={name:c?c[`division_${e+1}`]:null,roster:null,wins:-1,points:-1};for(const e of d){const r=e.settings,s=r.division?r.division:1;(r.wins>o[s].wins||r.wins==o[s].wins&&r.fpts+r.fpts_decimal/100==o[s].points)&&(o[s].points=r.fpts+r.fpts_decimal/100,o[s].wins=r.wins,o[s].roster=e.roster_id);const t=a[e.owner_id];n[e.roster_id]={rosterID:e.roster_id,avatar:"https://sleepercdn.com/images/v2/icons/player_default.webp",name:"Unknown Manager"},t&&(n[e.roster_id].avatar=`https://sleepercdn.com/avatars/thumbs/${t.avatar}`,n[e.roster_id].name=t.metadata.team_name?t.metadata.team_name:t.display_name)}return{divisions:o,prevManagers:n}};export{q as g};
